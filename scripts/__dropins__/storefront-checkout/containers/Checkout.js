import{w as D,n as P,x as h,i as k,y as T,P as ee,j as te}from"../chunks/getStoreConfig.js";import{U as re}from"../chunks/transform-shipping-methods.js";import{events as R}from"@dropins/tools/event-bus.js";import{p as oe,g as F,a as ne,b as ie}from"../chunks/placeOrder2.js";import{C as E}from"../chunks/ToggleButton.js";import{useEffect as ae}from"@dropins/tools/preact-hooks.js";import{classes as u,Slot as d}from"@dropins/tools/lib.js";import{IllustratedMessage as b,Icon as A,Button as N,Divider as S}from"@dropins/tools/components.js";/* empty css                             */import{jsx as t,jsxs as f,Fragment as v}from"@dropins/tools/preact-jsx-runtime.js";import*as o from"@dropins/tools/preact-compat.js";import{useState as M,useCallback as w,useEffect as ce}from"@dropins/tools/preact-compat.js";import{useText as C,Text as se,MarkupText as le}from"@dropins/tools/i18n.js";import{S as me}from"../chunks/ShippingMethods.js";import{L as de}from"../chunks/LoginForm.js";import{S as ue}from"../chunks/ShippingForm.js";import{B as pe}from"../chunks/BillToShippingAddress2.js";import{O as he}from"../chunks/OrderSummary.js";import{P as fe}from"../chunks/PaymentMethods.js";import{B as ke}from"../chunks/BillingForm.js";import{P as ge}from"../chunks/PlaceOrder.js";import{E as Ee}from"../chunks/ErrorBanner.js";import{C as Se}from"../chunks/CartSummary.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/preact.js";import"../chunks/getCart.graphql.js";import"../chunks/cart-item.js";import"../chunks/getMultilineValues.js";import"../chunks/SelectedShippingMethodSignal.js";import"../chunks/setShippingMethods.js";import"../chunks/setGuestEmailOnCart.js";import"../chunks/constants2.js";import"../chunks/setBillingAddress.js";import"../chunks/setShippingAddress.js";import"../chunks/constants.js";import"../chunks/setPaymentMethod.js";import"../chunks/constants3.js";const ve=n=>o.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},o.createElement("g",{clipPath:"url(#clip0_102_196)"},o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M18.3601 18.16H6.5601L4.8801 3H2.3501M19.6701 19.59C19.6701 20.3687 19.0388 21 18.2601 21C17.4814 21 16.8501 20.3687 16.8501 19.59C16.8501 18.8113 17.4814 18.18 18.2601 18.18C19.0388 18.18 19.6701 18.8113 19.6701 19.59ZM7.42986 19.59C7.42986 20.3687 6.79858 21 6.01986 21C5.24114 21 4.60986 20.3687 4.60986 19.59C4.60986 18.8113 5.24114 18.18 6.01986 18.18C6.79858 18.18 7.42986 18.8113 7.42986 19.59Z",stroke:"currentColor",strokeLinejoin:"round"}),o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M5.25 6.37L20.89 8.06L20.14 14.8H6.19",stroke:"currentColor",strokeLinejoin:"round"})),o.createElement("defs",null,o.createElement("clipPath",{id:"clip0_102_196"},o.createElement("rect",{vectorEffect:"non-scaling-stroke",width:19.29,height:19.5,fill:"white",transform:"translate(2.3501 2.25)"})))),V=n=>o.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...n},o.createElement("g",{clipPath:"url(#clip0_4797_15331)"},o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M10.25 20.91L1.5 17.55V6.51996L10.25 9.92996V20.91Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M6.24023 4.64001L14.9902 8.06001V11.42",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),o.createElement("path",{className:"error-icon",vectorEffect:"non-scaling-stroke",d:"M19 13.31L15.5 19.37H22.5L19 13.31Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),o.createElement("path",{className:"error-icon",vectorEffect:"non-scaling-stroke",d:"M19.0202 17.11H18.9802L18.9502 15.56H19.0502L19.0202 17.11ZM18.9602 18.29V18.06H19.0502V18.29H18.9602Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19 12.16V6.51996L10.25 9.92996V20.91L14.27 19.37L14.4 19.32",stroke:"currentColor",strokeLinejoin:"round"}),o.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M1.5 6.51999L10.25 3.04999L19 6.51999L10.25 9.92999L1.5 6.51999Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})),o.createElement("defs",null,o.createElement("clipPath",{id:"clip0_4797_15331"},o.createElement("rect",{width:22,height:18.86,fill:"white",transform:"translate(1 2.54999)"})))),Ce=({className:n,title:i,routeHome:e,...p})=>{const c=C({Title:"Checkout.EmptyCart.title",Button:"Checkout.EmptyCart.button"});return t(b,{...p,"data-testid":"checkout-empty-cart",className:u(["checkout-empty-cart",n]),heading:i??c.Title,icon:t(A,{className:u(["checkout-empty-cart__icon"]),source:ve}),action:e!=null&&e()?t(N,{className:"checkout-empty-cart__button",size:"medium",variant:"primary",type:"submit",href:e==null?void 0:e(),children:c.Button},"routeHome"):void 0})},ye=({className:n,icon:i,routeCart:e,...p})=>{const c=C({Title:"Checkout.OutOfStock.title",Message:"Checkout.OutOfStock.message"});return f("div",{...p,className:u(["checkout-out-of-stock",n]),"data-testid":"checkout-out-of-stock",children:[t(b,{heading:c.Title,message:t("p",{children:c.Message}),icon:t(A,{source:i??V,className:u(["checkout-out-of-stock__icon"])})}),(e==null?void 0:e())&&t(N,{className:"checkout-out-of-stock__button",size:"medium",variant:"primary",type:"submit",href:e==null?void 0:e(),children:t(se,{id:"Checkout.OutOfStock.button"})},"routeCart")]})},Le=({className:n,errorMessage:i,contactSupport:e,...p})=>{const{onClick:c}=p,a=C({Title:"Checkout.ServerError.title",Message:"Checkout.ServerError.message",ContactSupport:"Checkout.ServerError.contactSupport",Button:"Checkout.ServerError.button"});return t(b,{"aria-invalid":"true","aria-describedby":"checkout-server-error__message","aria-live":"polite",className:u(["checkout-server-error",n]),"data-testid":"checkout-server-error",heading:i??a.Title,message:f("p",{id:u(["checkout-server-error__message"]),children:[a.Message,t("br",{}),t(le,{id:"",children:e??a.ContactSupport})]}),icon:t(A,{className:u(["checkout-server-error__icon"]),source:V}),action:t(N,{className:u(["checkout-server-error__button"]),onClick:c,children:a.Button})})},ct="OUT_OF_STOCK";function Oe(){const{dispatch:n}=D();ae(()=>{const i=R.on("authenticated",e=>{P.value=e,n(e?{type:h.USER_AUTHENTICATED}:{type:h.USER_UNAUTHENTICATED})},{eager:!0});return()=>{i==null||i.off()}},[n])}const st=n=>{const{className:i,slots:e,routeHome:p,routeCart:c,preselectedCartData:a,onSignInClick:I,onSignOutClick:y,...Z}=n,{state:L,dispatch:s}=D(),[B,U]=M(""),H=B!=="",[G,z]=M(),[K,$]=M(!1),l=k.value.data,g=!!(l!=null&&l.virtual),q=C({CheckoutUnexpectedError:"Checkout.ServerError.unexpected"}),Y=w(async()=>{l&&(await oe(l.id),k.value={pending:!1},s({type:h.ORDER_PLACED}))},[l,s]),J=r=>{z(()=>r)},Q=async()=>{U(""),l&&(P.value?await _():await O(l.id))},x=r=>{U(r instanceof TypeError||r instanceof re?q.CheckoutUnexpectedError:r.message)},O=w(async r=>{const m=await F(r);s({type:h.CART_UPDATED,payload:m})},[s]),_=w(async()=>{const r=await F();await ne(),s({type:h.CART_UPDATED,payload:r})},[s]),j=async r=>{const m=await ie(r);$(m===ee.OutOfStock)};if(Oe(),ce(()=>{const r=R.on("cart/data",m=>{if(P.value){_(),j();return}if(m&&m.id){k.value={...k.value,pending:!0},O(m.id),j(m.id);return}k.value={data:null,pending:!1},s({type:h.CART_UPDATED,payload:null})},{eager:!0});return()=>{r==null||r.off()}},[s,_,O]),L===T.COMPLETE)return null;if(L===T.EMPTY)return t(Ce,{routeHome:p});if(H)return t(Le,{errorMessage:B,onClick:Q});const W=()=>{if(K)return t(E.Main,{outOfStock:t(ye,{routeCart:c})});const r=te.value.checked?"hidden":"visible";return t(E.Main,{sections:{billingAddress:f(v,{children:[t(d,{name:"BillingForm",className:r,slot:e==null?void 0:e.BillingForm,children:t(ke,{})}),t(S,{className:r,variant:"primary"})]}),billToShippingAddress:g?void 0:t(d,{name:"BillToShipping",slot:e==null?void 0:e.BillToShipping,children:t(pe,{})}),login:f(v,{children:[t(d,{name:"Login",slot:e==null?void 0:e.Login,children:t(de,{onSignInClick:I,onSignOutClick:()=>{s({type:h.USER_SIGN_OUT}),y==null||y()}})}),t(S,{variant:"primary"})]}),paymentMethods:f(v,{children:[t(d,{name:"PaymentMethods",slot:e==null?void 0:e.PaymentMethods,children:t(fe,{isShippingInfoRequired:!g,onPlaceOrder:J,handleServerError:x})}),t(S,{variant:"primary"})]}),placeOrder:t(ge,{onClick:G??Y,handleServerError:x}),shippingAddress:g?void 0:t(d,{name:"ShippingForm",slot:e==null?void 0:e.ShippingForm,children:t(ue,{preselectedFields:a==null?void 0:a.address})}),shippingMethods:g?void 0:f(v,{children:[t(d,{name:"ShippingMethods",slot:e==null?void 0:e.ShippingMethods,children:t(me,{preSelectedMethod:a==null?void 0:a.shippingMethod})}),t(S,{variant:"primary"})]})}})},X=()=>t(E.Aside,{sections:{cartSummary:t(d,{name:"CartSummary",slot:e==null?void 0:e.CartSummary,children:t(Se,{routeCart:c})}),orderSummary:t(d,{name:"OrderSummary",slot:e==null?void 0:e.OrderSummary,children:t(he,{})})}});return f(E,{className:i,banner:t(Ee,{}),isLoading:L===T.LOADING,...Z,children:[X(),W()]})};export{st as Checkout,ct as OUT_OF_STOCK,st as default};
//# sourceMappingURL=Checkout.js.map
